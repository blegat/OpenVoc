<% provide(:title, 'List') %>
<h1><%= @path %></h1>


<div class="row">
  <div class="span6">
    <div class="btn-group">
      <a class="btn dropdown-toggle" data-toggle="dropdown" href="#">
        Action <i class="icon-cog"></i>
        <span class="caret"></span>
      </a>
      <ul class="dropdown-menu">
        <% unless @list.nil? %>
          <li>
          <% if @list.parent.nil? %>
            <%= link_to "Go back to /", lists_path %>
          <% else %>
            <%= link_to "Go back to #{@list.parent.path}", @list.parent %>
          <% end %>
          </li>
          <% unless @moving %>
            <li>
            <%= link_to "Move", list_moving_path(@list) %>
            </li>
          <% end %>
          <li>
          <%= link_to "Export", list_export_path(@list) %>
          </li>
          <li>
          <%= link_to "Import", list_importing_path(@list) %>
          </li>
        <% end %>
        <% if @new_list.nil? %>
          <li>
          <%= link_to 'New list here', path_for_new_list(@list) %>
          </li>
        <% end %>
      </ul>
    </div>

    <% if @moving %>
      <%= form_for :dest, url: list_move_path(@list) do |f| %>
        <%= f.label :list_id, "Destination" %>
        <% if @list.parent.nil? %>
          <%= f.collection_select("list_id", current_user.lists_outside(@list), :id, :path) %>
        <% else %>
          <%= f.collection_select("list_id", current_user.lists_outside(@list), :id, :path, prompt: "/") %>
        <% end %>
        <br />
        <%= f.submit "Move", class: "btn" %>
      <% end %>
    <% end %>
    <% if @importing %>
      <%= form_for :file, url: list_preview_import_path(@list) do |f| %>
        <div class="form-group">
          <%= f.label :format, "Format of the file" %>
          <%= f.select(:format, supported) %>
        </div>
        <div class="form-group">
          <%= f.label :file, "File to import" %>
          <%= f.file_field :file %>
        </div>
        <div class="form-group">
          <%= f.label :column1, "Column from" %>
          <%= f.select(:column1, [["left", 1], ["right", 2]]) %>
          <p class="help-block">Column with the target language of the list.</p>
        </div>
        <div class="form-group">
          <%= f.label :split1, "Separator from" %>
          <%= f.text_field :split1 %>
          <p class="help-block">
          If you have multiple words per field.
          For example
          <code>happy, glad    | content</code>
          you can give <code>", "</code> so that the words "happy" and "glad" will be added with the translations
          "happy" to "content" and "glad" to "content" instead of the word "happy, glad" which doesn't exist.
          Be careful with the trailing spaces, if you split by <code>", "</code> and the field contains
          <code>happy,glad</code>, it won't be split up. You need to enter <code>","</code> (without the space).
          Leave it empty if you only have one word per field.
          </p>
        </div>
        <div class="form-group">
          <%= f.label :split2, "Separator to" %>
          <%= f.text_field :split2 %>
          <p class="help-block">
          This is the separator for the translations.
          </p>
        </div>
        <%= render 'languages/select', f: f, language: nil, n: 1 %>
        <%= render 'languages/select', f: f, language: nil, n: 2 %>
        <br />
        <%= f.submit "Preview import", class: "btn" %>
      <% end %>
    <% end %>
    <% unless @new_list.nil? %>
      <%= form_for @new_list, url: path_to_create_list(@list) do |f| %>
        <%= f.label :name %>
        <%= f.text_field :name %>
        <br />
        <%= f.submit "Create list here", class: "btn" %>
      <% end %>
    <% end %>

    <h2>Sublists</h2>
    <% if @lists.empty? %>
      <p>No sublist.</p>
    <% else %>
      <ul>
        <% @lists.each do |list| %>
          <li>
          <%= link_to list.name, list %>
          </li>
        <% end %>
      </ul>
    <% end %>
    <% unless @list.nil? %>
      <h2>Words</h2>
      <% if @words.empty? %>
        <p>No word.</p>
      <% else %>
        <%= will_paginate @words %>
        <ul>
          <% @words.each do |word| %>
            <li>
            <%= link_to word.content, word %>
            <% if @list.owner == current_user %>
              <%= link_to "", list_word_path(@list, word), method: :delete, class: "icon-remove" %>
            <% end %>
            </li>
          <% end %>
        </ul>
        <%= will_paginate @words %>
      <% end %>

      <h2>Training</h2>
      <%= form_for(:train, url: list_training_path(@list)) do |f| %>
        <fieldset>
          <legend>Filter</legend>
          <span class="help-block">
            By default, all the words can be asked.
            Here is filters you can apply.
            If you have an idea for another filter, please
            <%= link_to_bug_tracker 'let us know' %>.
          </span>
          <%= f.label :max, "Maximum success rate" %>
          <%= f.number_field :max, value: 100 %>
          <span class="help-block">
            A word with a success rate higher than this
            won't be asked.
            This is the average success rate of every user.
          </span>
          <%= f.label :rec do %>
            <%= f.check_box :rec %>
            pick words from sublists too
          <% end %>
        </fieldset>
        <fieldset>
          <legend>Priority</legend>
          <span class="help-block">
            You are first asked the words that you have never tried and that
            have a success rate lower or equal than the maximum success rate.
            Once you have tried every word or all the words you haven't
            tried are too easy according to your filters,
            you are asked the words you have not tried
            for the longest time first.
            More options will be added.
            If you have an idea for an option, please
            <%= link_to_bug_tracker 'let us know' %>.
          </span>
        </fieldset>
        <%= f.submit "Start training", class: 'btn btn-large btn-primary' %>
      <% end %>
    <% end %>
  </div>

  <% if not @list.nil? and @list.owner == current_user %>
    <div class="span6">
      <h2>New links</h2>
      <p>
      Quickly add new words to this list while ensuring your
      requested link is present.
      If the words or the link doesn't exist, it will be added.
      </p>
      <%= render 'links/new' %>
    </div>
  <% end %>
</div>
